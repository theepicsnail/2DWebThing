<html>
    <head>
        <title></title>
        <script src="js/jquery.min.js"></script>
        <script src="js/ChangeableValue.js"></script>
        <script src="js/Display.js"></script>
        <script src="js/Map.js"></script>
        <script src="js/SpriteSheet.js"></script>
        <script type="text/javascript">
        var display, ss, sprite, map, world;
        $(function(){
            display = new Display(320,320);
            $('#container').append(display.canvas);
//            map = new Map("LayerTest");
            map = new Map("Level1"); 
            map.mapLoaded = function(map){ display.loadMap(map); }
            
            display.mapLoaded= function (){
                display.startUpdates();
                ss = new SpriteSheet("Sprites",32);
                ss.onload = function(){
                    console.log("Sprite");
                    sprite = new Sprite(ss,0,0);
                    display.addSprite(sprite);
                    sprite.position.set([5,5]);
                    world = 1;
                };
                display.mapLoaded=function(){}
            }
            
            /*display.setGridDimensions(10,10);


            ss1 = new SpriteSheet("dirt",48);
            ss1.onload = function(){
                console.log("dirt.");
                for(var r = 0 ; r < 10 ; r ++)
                for(var c = 0 ; c < 10 ; c ++){
                    var sprite1 = new Sprite(ss1,0,0);
                    sprite1.position.set([r,c]);
                    display.addSprite(sprite1);
                }
            };

            ss = new SpriteSheet("betty",48);
            ss.onload = function(){
                sprite = new Sprite(ss,0,0);
                display.addSprite(sprite);
                sprite.position.set([0,0]);
            };
*/
            $("body").keydown(function(key){
                pos = sprite.position.get() // [row, col]
                switch(key.which){
                    case 38:
                    case 87://up
                        sprite.move(NORTH,map);
                    break;
                    case 40:
                    case 83://down
                        sprite.move(SOUTH,map);
                    break;
                    case 37:
                    case 65://left
                        if(sprite.move(WEST,map))
                        {
                            console.log("Changing worlds, WEST");
                            world --;
                            map = new Map("Level"+world);
                            map.mapLoaded = function(map){
                                display.loadMap(map);
                                display.mapLoaded = function(){
                                    var pos = sprite.position.get();
                                    pos[1]=map.layers[0].data[0].length-1
                                    sprite.position.set(pos);
                                }
                            }
                        } 
                    break;
                    case 39:
                    case 68://right
                        if(sprite.move(EAST,map)){
                            console.log("Changing worlds, EAST");
                            world ++;
                            map = new Map("Level"+world);
                            map.mapLoaded = function(map){
                                display.loadMap(map);
                                display.mapLoaded = function(){
                                    var pos = sprite.position.get();
                                    pos[1]=0
                                    sprite.position.set(pos);
                                }
                            }

                        }
                    break;
                    case 49:            
                        map = new Map("Level1"); 
                        map.mapLoaded = function(map){ display.loadMap(map); }
                    break;
                    case 50:            
                        map = new Map("Level2"); 
                        map.mapLoaded = function(map){ display.loadMap(map); }
                    break;
                    case 51:            
                        map = new Map("Level3"); 
                        map.mapLoaded = function(map){ display.loadMap(map); }
                    break;
                }
            });
        });
        </script>
            
        
    </head>
    <body>
        <div id="container">
        </div>
    </body>
</html>

